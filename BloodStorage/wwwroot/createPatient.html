<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/site.css" />
    <title></title>
</head>
<body>
    <nav>
        <label class="logo">Patient Finder</label>
        <ul>
            <li><a href="Home.html">Home</a></li>
            <li><a href="PatientList.html">Patient List</a></li>
            <li><a href="createPatient.html">Create Patient</a></li>
            <li><a href="DeletePatient.html">Delete Patient</a></li>
        </ul>
    </nav>

    <div>

        <form action="javascript:addNewTodoItem()" style="margin-top: 10px">

            <div>
                <label for="newName">Enter your full name</label>
                <input type="text" id="newName" placeholder="Name..."> <br /> <br />
            </div>

            <div>
                <label for="newAdress">Please enter your full address</label>
                <input type="text" id="newAdress" placeholder="Adress..."> <br /> <br />
            </div>

            <div>
                <label for="age">Please enter your age </label>
                <input type="text" id="newAge" placeholder="Age..."> <br /> <br />
            </div>

            <div>
                <label for="newPostcode">Please enter PostCode</label>
                <input type="text" id="newPostcode" placeholder="Postcode...">
            </div>

            <div>
                <input type="submit" value="Add" class="addButton" />
            </div>
        </form>

    </div>


    <script>
        function addNewTodoItem(newItemValue) {

            // Get the value from the Input field in the FORM
            let nameValue = document.getElementById("newName").value.trim();
            let postcodeValue = document.getElementById("newPostcode").value.trim();
            let ageValue = document.getElementById("newAge").value.trim();
            let adressValue = document.getElementById("newAdress").value.trim();

            // Check that a value have added
            if (nameValue === "") {
                alert("Please enter a value for your item");
            }
            createTodoItem(nameValue, ageValue, postcodeValue, adressValue);
            document.getElementById("newName").value = "";
            document.getElementById("newPostcode").value = "";
            document.getElementById("newAge").value = "";
            document.getElementById("newAdress").value = "";

        }

        function createTodoItem(newName, newAge, newPostCode, newAdress) {

            // Create a new JSON object for the new item with the status of NEW
            // Since the id is generated by the microservice, we will use -1 as a dummy
            // If the POST is successful the microservice will store the new item in the database
            // and returns a JSON via the response with the generated id for the new item
            const newItem = { "name": newName, "age": newAge, "postCode": newPostCode, "address": newAdress };
            const requestOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newItem)
            };
            fetch('https://localhost:7289/api/Patient', requestOptions)
                // get the JSON content from the response
                .then((response) => {
                    if (!response.ok) {
                        alert("An error has occurred.  Unable to create the TODO item")
                        throw response.status;
                    } else return response.json();
                })

                // add the item to the UL element so that it will appear in the browser
                .then(item => addTodoItemToDisplay(item));
        }




    </script>
</body>
</html>